{{/* Generates a valid Algolia search index */}}
{{- $hits := slice -}}
{{- $validParams := $.Site.Params.algolia.params | default slice -}}
{{- range $i, $hit := where .Data.Pages "Params.private" "ne" "true" -}}
  {{- $dot := . -}}
  {{- .Scratch.SetInMap $hit.File.Path "title" $hit.Title -}}
  {{- .Scratch.SetInMap $hit.File.Path "permalink" $hit.Permalink -}}
  {{- .Scratch.SetInMap $hit.File.Path "lang" $hit.Lang -}}
  {{- .Scratch.SetInMap $hit.File.Path "lastmod" $hit.Lastmod.UTC.Unix -}}
  {{- .Scratch.SetInMap $hit.File.Path "date" $hit.Date.UTC.Unix -}}
  {{- .Scratch.SetInMap $hit.File.Path "publishdate" $hit.PublishDate.UTC.Unix -}}
  {{- .Scratch.SetInMap $hit.File.Path "expirydate" $hit.ExpiryDate.UTC.Unix -}}
  {{- .Scratch.SetInMap $hit.File.Path "summary" $hit.Summary -}}
  {{- .Scratch.SetInMap $hit.File.Path "readingTime" $hit.ReadingTime -}}
  {{- .Scratch.SetInMap $hit.File.Path "weight" $hit.Weight -}}
  {{- .Scratch.SetInMap $hit.File.Path "section" $hit.Section -}}
  {{- range $key, $param := $hit.Params -}}
    {{- if in $validParams $key -}}
      {{- $dot.Scratch.SetInMap $hit.File.Path $key $param -}}
    {{- end -}}
  {{- end -}}
  {{- $.Scratch.SetInMap "hits" $hit.File.Path (.Scratch.Get $hit.File.Path) -}}
{{- end -}}
{{- jsonify ($.Scratch.GetSortedMapValues "hits") -}}