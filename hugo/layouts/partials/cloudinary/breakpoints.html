{{- if and (isset . "image") (isset . "page") }}
  {{- $page := .page -}}
  {{- $presetName := .preset | default "default" -}}
  {{- $presets := $page.Site.Params.cloudinary.presets | default "" -}}
  {{- $preset := cond (eq $presets "") "" (index $presets $presetName) -}}
  {{- $page.Scratch.Set "image" .image -}}
  {{- $page.Scratch.Set "width" ($preset.width | default "800") -}}
  {{- $page.Scratch.Set "breakpoints" (slice "") -}}
  {{- $page.Scratch.Set "sizes" ($preset.sizes | default "100vw") -}}
  {{- $page.Scratch.Set "quality" ($preset.quality | default "auto") -}}
  {{- $page.Scratch.Set "min_width" ($preset.min_width | default 320) -}}
  {{- $page.Scratch.Set "max_width" ($preset.max_width | default 1024) -}}
  {{- $page.Scratch.Set "steps" ($preset.steps | default 10) -}}
  {{- $page.Scratch.Set "step_bytes" ($preset.step_bytes | default 20) -}}
  {{- if eq (getenv "HUGO_ENV") "production" }}
    {{- $width_query := delimit (slice "auto:breakpoints_" ($page.Scratch.Get "min_width") "_" ($page.Scratch.Get "max_width") "_" ($page.Scratch.Get "step_bytes") "_" ($page.Scratch.Get "steps") ":json") "" -}}
    {{- $endpoint := (partial "cloudinary/url.html" (dict "page" $page "image" ($page.Scratch.Get "image") "width" $width_query "isbreakpoints" true)) -}}
    {{- $response := getJSON (printf "%s" $endpoint) -}}
    {{- delimit $response.breakpoints "," -}}
  {{ end -}}
{{ end -}}